<!DOCTYPE html>
<html>
  <head>
    <title>Customer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
  </head>
  <body>

    <div class="navbar navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="brand" href="#">Customer</a>
        </div>
      </div>
    </div>

    <div class="container-fluid">

      <div class="hero-unit row-fluid" style="padding: 15px 15px 0 15px;">
        <form id="new-user">
          <fieldset>
            <legend>Looks like you're new around here!</legend>
            <label>Nick Name: </label>
            <input type="text" placeholder="Shoppy McCustomer...">
          </fieldset>
          <br>
          <button class="btn btn-success" type="submit">Start Scanning!</button>
        </form>
      </div>
      <!-- /form#new-user -->

      <div class="row-fluid">
        <form>
          <fieldset>
            <legend>UPCs</legend>
            <p>
              <input type="text" name="upcs[]"><a style="bottom: 5px; position: relative;left: 10px; margin-right: 10px; cursor: pointer;color: #CCC;">Remove</a><a style="bottom: 5px;position: relative;left: 10px;cursor: pointer;color: #CCC;">Add</a>
              <br>
            </p>

            <button type="submit" class="btn">Submit</button>
          </fieldset>
        </form>
        <!-- /form -->
      </div>

    </div>

    <div id="feedback"><div>
    <!--
    <p>Your request has been successfully submitted!</p>
    <p>Your request is being processed!</p>
    <p>Your request is ready at location: %n%</p>
    -->

    <!-- scripts -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.0/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
    if (sessionStorage.bar) {
      sessionStorage.bar += 1;
      //alert(sessionStorage.bar);
    } else {
      sessionStorage.bar = 1;
    }
    </script>
    <script type="text/javascript">
    var config = {
      "host": "http://localhost",
      "port": 8080
    }
    </script>
    <script>
      var socket = io.connect(config.host);

      socket.on('message', function (message, callback) {
        console.log(message);
      });

      socket.on('processingQueueUpdated', function (data) {
        // body...
      });

      socket.on('fittingRoomAssigned', function (data) {
        // body...
      });

      socket.on('orderProcessingStarted', function (data) {
        // body...
      });

      socket.on('discardedItemReceived', function (data) {
        // body...
      });

      socket.on('itemReady', function (data) {
        console.log('An associate just grabbed an item. Go to your fitting room now');
        $('#feedback').append('<p>your item is ready!</p>');
      });
    </script>
    <script type="text/javascript">
    $(function () {

      $('form').submit(function (e) {
        e.preventDefault();

        self = $(this);

        var order = {
          nickName: '',
          fruits: []
        };

        // NickName
        var nickName = self.find('input[name="nickName"]').val();
        order.nickName = nickName || 'Anonymous';

        // Fruits
        self.find('input[name="fruits"]:checked').each(function () {
          order.fruits.push($(this).val());
        });

        $.ajax({
          type: "GET",
          url: config.host + ':' + config.port,
          data: order
        }).done(function (res) {
          self.toggle();
          console.log('Request Submitted!');
          socket.emit('requestSubmitted', order);
        });

      });

      $('#toggle-connection').click(function () {

        var self = $(this)
          , form = $('form');

        if (!self.data('connectionStatus')) {
          self.data('connectionStatus', true);
          io.connect();
          self.text('Disconnect');
        } else {
          self.data('connectionStatus', false);
          socket.disconnect();
          self.text('Connect');
        }

        form.toggle();
      });
    });
    </script>
  </body>
</html>